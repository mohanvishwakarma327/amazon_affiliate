<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Product Analytics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #f0f0f0;
      margin: 0;
      padding: 30px 15px;
      animation: fadeIn 1s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .container {
      max-width: 1000px;
      margin: auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      font-size: 2em;
      letter-spacing: 1px;
      animation: slideDown 0.6s ease-out;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .btn-download {
      background: linear-gradient(45deg, #28a745, #43e97b);
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      display: block;
      margin: 0 auto 30px auto;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(40, 167, 69, 0.4);
    }

    .btn-download:hover {
      background: linear-gradient(45deg, #43e97b, #38f9d7);
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(40, 167, 69, 0.6);
    }

    canvas {
      background: #1e1e1e;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      animation: fadeIn 1.2s ease-in;
    }

    table {
      width: 100%;
      margin-top: 40px;
      border-collapse: collapse;
      background: #1e1e1e;
      color: white;
      border-radius: 8px;
      overflow: hidden;
      animation: fadeInUp 0.8s ease-in;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    th, td {
      padding: 14px 16px;
      border-bottom: 1px solid #333;
      text-align: left;
    }

    th {
      background: #2a2a2a;
      font-weight: 600;
    }

    tr:hover {
      background: #292929;
      transition: background 0.2s ease-in;
    }

    @media (max-width: 600px) {
      canvas {
        width: 100% !important;
      }

      table, thead, tbody, th, td, tr {
        display: block;
      }

      thead {
        display: none;
      }

      td {
        position: relative;
        padding-left: 50%;
        border-bottom: 1px solid #444;
        margin-bottom: 10px;
      }

      td::before {
        content: attr(data-label);
        position: absolute;
        left: 16px;
        top: 14px;
        font-weight: bold;
        color: #aaa;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>üìä Product Click Analytics</h1>

  <button class="btn-download" onclick="downloadCSV()">‚¨áÔ∏è Download CSV</button>

  <canvas id="clickChart" height="150"></canvas>

  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Category</th>
        <th>Clicks</th>
      </tr>
    </thead>
    <tbody>
      {% for p in products|sort(attribute='clicks', reverse=true) %}
      <tr>
        <td data-label="Title">{{ p.title }}</td>
        <td data-label="Category">{{ p.category }}</td>
        <td data-label="Clicks">{{ p.clicks }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  const products = {{ products | tojson }};
  const ctx = document.getElementById('clickChart').getContext('2d');

  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: products.map(p => p.title),
      datasets: [{
        label: 'Clicks',
        data: products.map(p => p.clicks),
        backgroundColor: 'rgba(54, 162, 235, 0.8)',
        borderRadius: 5,
        barThickness: 40
      }]
    },
    options: {
      animation: {
        duration: 1200,
        easing: 'easeOutBounce'
      },
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            color: '#ccc',
            precision: 0
          },
          grid: {
            color: '#333'
          }
        },
        x: {
          ticks: {
            color: '#ccc',
            maxRotation: 45,
            minRotation: 30
          },
          grid: {
            color: '#333'
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: '#ddd'
          }
        }
      }
    }
  });

  function downloadCSV() {
    let csv = 'Title,Category,Clicks\n';
    products.forEach(p => {
      csv += `${p.title.replace(/,/g, '')},${p.category},${p.clicks}\n`;
    });

    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.setAttribute('href', URL.createObjectURL(blob));
    link.setAttribute('download', 'product_clicks.csv');
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
</script>

</body>
</html>
